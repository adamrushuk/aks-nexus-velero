---
# INIT
- name: admin access check
  uri:
    url: "{{ api_url }}/v1/status/"
    method: GET
    user: "admin"
    password: "{{ admin_password }}"
    status_code: 200,401
  ignore_errors: true
  register: admin_access_response

- name: change admin password
  uri:
    url: "{{ api_url }}/beta/security/users/admin/change-password"
    method: PUT
    user: "admin"
    password: "{{ autogenerated_admin_password }}"
    headers:
      Content-Type: text/plain
    body: "{{ admin_password }}"
    status_code: 200,204
  when: admin_access_response.status != 200

- name: set active realms
  uri:
    url: "{{ api_url }}/beta/security/realms/active"
    method: PUT
    body: "{{ active_realms }}"
    status_code: 200,204
